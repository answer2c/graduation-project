<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>上传书籍</title>

    <link rel="stylesheet" href="SITE_URL/static/css/book.css">
    <link rel="stylesheet" href="SITE_URL/static/css/bootstrap.css"> 
    <link rel="shortcut icon" type="image/x-icon" href="SITE_URL/static/image/ic.png">
    <style>
        #bookphoto{
    display: inline-block !important;
    width:100px !important;
    height:150px !important;
    }


    </style>
</head>
<body>



     
        <!-- 导航栏 -->
        <nav class="navbar navbar-static-top navbar-inverse">
            <div class="container-fluid">
                <div class="navbar-header">
                    <span id="mytitle" class="nav-brand">BookShare</span>
                    <button class="navbar-toggle" data-target=".hidemenu" data-toggle="collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse hidemenu">
                        <ul class="nav navbar-nav navbar-left">
                            <li><a href="{:url('/book')}">首页</a></li>
                            <li><a href="{:url('/book/index/lend')}">借书</a></li>
                            <li><a href="#">还书</a></li>
                            <li><a href="{:url('/book/index/upload')}">上传书籍</a></li>
                            <li class="dropdown" >
                                <a href="http://" data-toggle="dropdown" class="dropdown-toggle" >帮助
                                    <span class="caret"></span>
                                </a>
                                <ul class="dropdown-menu">
                                    <li class=""><a href="#" >借书流程</a></li>
                                    <li class="divider"></li>
                                    <li><a href="#">常见问题</a></li>
                                
                                </ul>
                            
                            
                            </li>
                           

                        </ul>
                        <ul class="nav navbar-nav navbar-right">
                            {$loginMess}
                        </ul>
                   
                </div>
            </div>

    </nav>
 <!-- 导航栏结束 -->

 
 
 <div class="container">
                   
    <form action="" method="post" class="form-horizontal" id="myform">
        <div class="form-group has-feedback ">
            
               <label for="isbn" class="col-xs-5 col-sm-3 control-label">ISBN号：</label>
               <div class="col-xs-8 col-sm-5">
                <input type="text" id="isbn" class="form-control ajaxcheck" name="isbn" placeholder="ISBN">
                <input type="button" name="sub" value="确认" id="sub" class="btn btn-success" >
                   
               </div> 
              
        </div>

      


        <div class="detail">
            
            <div class="form-group">
                
                <label for="bookphoto" class="col-xs-5 col-sm-3 control-label">封面：</label>
                <div class="col-xs-8 col-sm-5">
                        <input type="hidden" name="bookimg" id="bookimg">
                 <img  id="bookphoto">
                 </div>                 
            </div>


            <div class="form-group">              
                <label for="bookname" class="col-xs-5 col-sm-3 control-label">书名：</label>
                <div class="col-xs-8 col-sm-5">
                    <input type="text" id="bookname" class="form-control" name="bookname" readonly>           
                </div>                 
            </div>

            <div class="form-group">             
                <label for="author" class="col-xs-5 col-sm-3 control-label">作者</label>
                <div class="col-xs-8 col-sm-5">
                <input type="text" id="author" class="form-control" name="author" readonly>              
                </div>                 
            </div>

        

            
            <div class="form-group">
                
                <label for="publisher" class="col-xs-5 col-sm-3 control-label">出版社：</label>
                <div class="col-xs-8 col-sm-5">
                <input type="text" id="publisher" class="form-control" name="publisher" readonly>
                </div>                 
            </div>

            <div class="form-group">           
                <label for="pubdate" class="col-xs-5 col-sm-3 control-label" >出版时间：</label>
                <div class="col-xs-8 col-sm-5">
                <input type="text" id="pubdate" class="form-control" name="pubdate" readonly>
                </div>                 
            </div>

            <div class="form-group">           
                <label for="booktag" class="col-xs-5 col-sm-3 control-label" >标签：</label>
                <div class="col-xs-8 col-sm-5">
                <input type="text" id="booktag" class="form-control" name="booktag" readonly >
                </div>                 
            </div>
           
            <div class="form-group">           
                    <label for="price" class="col-xs-5 col-sm-3 control-label" >单价：</label>
                    <div class="col-xs-8 col-sm-5">
                    <input type="text" id="price" class="form-control" name="price" readonly >
                    </div>                 
            </div>

            <div class="form-group">
                <div class="col-md-offset-4 col-sm-2 col-xs-3">
                <input type="button" name="sub2" value="上传" id="sub2" class="btn btn-success" >
                </div>
                <div class="col-sm-4 col-xs-3">
                <input type="button" value="重新输入" class="btn btn-danger" id="reset">
                </div>
            </div> 
           
     </div>
    </form>
    





  
</div> 






   
    
    <script src="SITE_URL/static/js/jquery-3.2.1.js"></script>
    <script src="SITE_URL/static/js/bootstrap.min.js"></script>
    <script src="SITE_URL/static/js/upload.js"></script>
    <script>
 
    $("#sub").click(function(){
        if($("#isbn").val()==""){
            alert('不能为空！');
        }else{
            var isbn=$("#isbn").val();
            $.ajax({
            type:"GET",
            url:"https://api.douban.com/v2/book/isbn/"+isbn,
            dataType:"jsonp",
            success:function(result){
                if(result){
                    $(".detail").show();
                }
                $("#sub").hide();
                $("#isbn").attr("readonly",true);
                $("#isbn").attr("disabled",false);
                $("#bookname").val(result.title);
                $("#publisher").val(result.publisher);
                $("#pubdate").val(result.pubdate);
                $("#author").val(result.author);
                $("#price").val(result.price);
                var tags="";
                for(var i=0;i<2;i++){
                    tags+=result.tags[i].name;
                    tags+=" ";
                }
                $("#booktag").val(tags);
                $("#bookphoto").attr("src",result.image);
                $("#bookimg").val(result.image);

                },
            error:function(){
                alert('没有查询到对应书籍');
                 }
            })
        }
    })
    $("#sub2").click(function(){
        var isbn = $("#isbn").val();
        var bookimg = $("#bookimg").val();
        var bookname = $("#bookname").val();
        var author = $("#author").val();
        var publisher = $("#publisher").val();
        var pubdate = $("#pubdate").val();
        var booktag = $("#booktag").val();
        var price = $("#price").val();
        var data="&isbn="+isbn+"&bookimg="+bookimg+"&bookname="+bookname+"&author="+author+"&publisher="+publisher+"&pubdate="+pubdate+"&booktag="+booktag+"&price="+price;

            $.ajax({
            type:"post",
            url:"/book/index/addbook",
            data:data,
            dataType:"json",
            success:function(result){
                if(result.status == 1){
                    alert(result.data);
                    window.location='/book/index/'
                }else{
                    alert('上传失败');
                }
            },
            error:function(result){
                console.log(result);
                // alert('上传失败');
            }
        })
    })
    </script>
</body>
</html>